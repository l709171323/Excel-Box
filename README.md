# Excel 工具箱 V2.3

功能强大的 Excel 批量处理工具，支持 SKU 填充、州名转换、仓库路由、PDF OCR、发货模板填充等多种实用功能。

> 📢 **最新版本** (2025-12-12): 已完成打包优化，支持自定义图标，程序体积约 900MB（包含完整 OCR 引擎）

## 核心功能

### 已实现功能（11个）
1. **州名转换** - 美国州名与缩写互转
2. **SKU 智能填充** - 自动填充匹配的 SKU 数据
3. **高亮重复项** - 标注重复数据行
4. **插入缺失行** - 按规则插入空白行
5. **对比列数据** - 比较两列差异（支持忽略重复）
6. **PDF OCR 拆分** - 拆分 PDF 并 OCR 识别订单号
7. **前缀批量填充** - 为指定列添加前缀
8. *（预留）*
9. **仓库路由建议** - 基于距离推荐最优发货仓库
10. **库存信息录入** - 管理仓库库存数据
11. **发货模板填充** - 自动填充发货单模板

## 项目结构

```
Python-O/
├── main.py                 # 程序入口
├── build_exe.py            # 一键打包脚本
├── icon.ico                # 程序图标
├── requirements.txt        # Python 依赖
├── excel_toolkit/          # 核心模块
│   ├── app.py             # 主界面
│   ├── states.py          # 功能1：州名转换
│   ├── sku_fill.py        # 功能2：SKU填充
│   ├── highlight.py       # 功能3：高亮重复
│   ├── insert_rows.py     # 功能4：插入行
│   ├── compare.py         # 功能5：对比列
│   ├── pdf_ocr.py         # 功能6：PDF OCR
│   ├── prefix_fill.py     # 功能7：前缀填充
│   ├── warehouse_router.py # 功能9：仓库路由
│   ├── shipping_fill.py   # 功能11：发货填充
│   └── ui/                # UI 组件
└── vendor/                # 第三方依赖
    ├── poppler/           # PDF 处理
    └── tesseract/         # OCR 引擎
```

## 快速开始

### 方式1：直接使用（推荐）

1. 解压 `Excel工具箱` 文件夹
2. 双击运行 `Excel工具箱.exe`
3. 无需安装任何依赖！

### 方式2：开发环境

**环境要求**：
- Python 3.9+ (Windows)
- 依赖包：见 `requirements.txt`

**安装依赖**：
```bash
pip install -r requirements.txt
```

**运行程序**：
```bash
python main.py
```

## 打包发布

### 一键打包（推荐）

```bash
python build_exe.py
```

**打包选项**：
- `--onefile` - 打包成单个 EXE（启动慢，约 1GB）
- `--debug` - 显示控制台窗口（用于调试）
- `--no-paddle` - 排除 PaddleOCR（减小体积约 500MB）

**默认配置**：
- 模式：文件夹模式（快速启动）
- 输出：`dist/Excel工具箱/`
- 图标：`icon.ico`（自动应用）
- 大小：约 900MB（包含所有依赖）

### 更换图标

1. 准备 `.ico` 格式图标文件
2. 重命名为 `icon.ico`
3. 放到项目根目录
4. 重新运行 `python build_exe.py`

**ICO 文件制作**：
- 在线转换：https://www.icoconverter.com/
- 推荐尺寸：256x256、128x128、64x64、48x48、32x32、16x16

# 使用说明

### 通用注意事项

⚠️ **重要**：
- 处理前请**关闭所有 Excel 文件**（避免保存失败）
- 文件路径不要包含特殊字符
- 建议先备份重要文件

### 操作流程

1. **选择功能标签页**（如"SKU填充"、"仓库路由"等）
2. **选择输入文件**（点击"浏览"按钮）
3. **配置参数**（列号、工作表名等）
4. **点击"开始处理"**
5. **查看日志**（界面内实时显示）
6. **完成提示**（弹窗显示结果）

### 功能9：仓库路由建议

**功能说明**：根据 SKU 库存和距离，智能推荐最优发货仓库

**库存文件格式**：
- Sheet `仓库名和地址`：
  - A列：仓库名称
  - B列：所在州（全称或缩写）
- 其他 Sheet：以仓库名称命名
  - A列：SKU 列表

**计算逻辑**：
1. 按 SKU 筛选可用仓库
2. 计算收件州与仓库州的距离（哈弗辛公式）
3. 选择最近的仓库

**特殊功能**：
- 屏蔽州：勾选后 GA/TX 不参与计算
- 日志可视化：表格展示仓库/州/SKU 信息

### 功能10：库存信息录入

- 在界面内录入仓库、州和 SKU
- 保存为标准库存文件（符合功能9格式）
- 支持导入现有库存文件编辑
- 自动同步到功能9

### 功能11：发货模板填充

**功能说明**：根据订单信息自动填充发货模板

**配置文件格式**（Excel）：
- Sheet1（映射1）：订单列 → 模板列
- Sheet2（映射2）：订单列 → 模板列（可选）
- 其他 Sheet：仓库承运商映射
  - A列：承运商
  - B列：物流渠道

**使用步骤**：
1. 准备配置文件（映射关系）
2. 选择订单文件和模板文件
3. 选择使用映射1或映射2
4. 可选：筛选指定仓库
5. 开始填充

### 功能6：PDF OCR 拆分

**功能说明**：将多页 PDF 拆分，并 OCR 识别订单号重命名

**使用方法**（GUI 界面）：
1. 选择输入 PDF 文件
2. 选择输出目录
3. 设置 OCR 识别区域（左/上/宽/高）
4. 可选：设置订单号正则表达式
5. 开始处理

**依赖说明**：
- 程序已内置 Tesseract OCR 和 Poppler
- 如需手动配置，在界面中指定路径：
  - Poppler bin：`vendor/poppler/bin`
  - Tesseract exe：`vendor/tesseract/tesseract.exe`

**坐标说明**：
- 使用像素坐标 `x,y,width,height`
- 原点在左上角
- DPI 通常设置为 300

**输出规则**：
- 每页生成一个独立 PDF
- 文件名优先使用 OCR 识别的订单号
- 识别失败则使用 `page_001.pdf` 格式

## 技术说明

### 依赖管理

**第三方依赖**（已集成到打包程序）：
- **Poppler**：PDF 处理引擎
  - 位置：`vendor/poppler/bin`
  - 自动检测路径
- **Tesseract OCR**：文字识别引擎
  - 位置：`vendor/tesseract/`
  - 包含完整 `tessdata` 语言包
- **PaddleOCR**：高级 OCR 引擎（可选）
  - 体积约 500MB
  - 打包时可用 `--no-paddle` 排除

**Python 依赖**：
```txt
openpyxl>=3.1.0
pytesseract>=0.3.10
pdf2image>=1.16.0
pypdf>=3.0.0
pillow>=10.0.0
paddleocr>=2.7.0  # 可选
```

### 数据库说明

⚠️ **重要**：本项目**不使用数据库**！
- 所有数据基于 Excel 文件处理
- 配置通过 Excel 文件管理
- 无需安装数据库软件

### 体积优化

**完整版**（约 900MB）：
- 包含 PaddleOCR
- 包含 Tesseract
- 包含 Poppler

**精简版**（约 400MB）：
- 排除 PaddleOCR
- 保留 Tesseract（基础 OCR）
- 保留 Poppler（PDF 处理）

**打包精简版**：
```bash
python build_exe.py --no-paddle
```

## 版本历史

### V2.3 (2025-12-12)
- ✅ 完成打包优化
- ✅ 支持自定义图标
- ✅ 移除数据库依赖
- ✅ 清理冗余代码和文档
- ✅ 优化程序启动速度

### V2.0 (2025-11)
- ✅ 模块化重构
- ✅ 新增功能6-11
- ✅ 集成 OCR 引擎
- ✅ UI 优化

### V1.1 (2025初)
- ✅ 基础功能实现（1-5）
- ✅ 首个稳定版本

## 常见问题

**Q: 程序启动慢？**
A: 首次启动需要加载 OCR 引擎，约 10-30 秒。建议使用文件夹模式打包（默认）而非单文件模式。

**Q: 找不到依赖？**
A: 确保 `vendor/` 目录与 EXE 在同一位置。打包后整个文件夹一起分发。

**Q: Excel 保存失败？**
A: 关闭所有正在使用的 Excel 文件，确保文件未被占用。

**Q: 如何更换图标？**
A: 准备 `.ico` 文件，重命名为 `icon.ico`，放到项目根目录，重新运行 `python build_exe.py`。

**Q: 打包文件太大？**
A: 使用 `python build_exe.py --no-paddle` 排除 PaddleOCR，可减小约 500MB。

## 开发者信息

**技术栈**：
- Python 3.11
- Tkinter (GUI)
- OpenPyXL (Excel 处理)
- PyInstaller (打包)
- Tesseract/PaddleOCR (文字识别)
- Poppler (PDF 处理)

**贡献指南**：
1. Fork 本项目
2. 创建功能分支
3. 提交代码
4. 发起 Pull Request

## 许可证

MIT License

---

**最后更新**：2025-12-12